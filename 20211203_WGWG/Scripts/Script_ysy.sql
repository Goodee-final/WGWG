--윤수연 부분
DROP TABLE CHAT_ROOM ;
DROP TABLE CHAT_MEMBER ;
DROP TABLE CHAT_MESSAGE ;

/* 채팅멤버 */
CREATE TABLE CHAT_MEMBER (
	MEM_NO NUMBER(16) PRIMARY KEY, /* 멤버id */
	CHAT_MEMBER_ST VARCHAR2(10), /* 채팅방참여상태 */
	CHAT_MEMBER_JOIN_DT DATE, /* 채팅방참여시간 */
	EMP_NO NUMBER(16), /* EMP_NO */
	CONSTRAINTS EMP_NO FOREIGN KEY(EMP_NO) 
	REFERENCES EMP (EMP_NO)
);

/* 채팅메시지  */
CREATE TABLE CHAT_MESSAGE (
	CHAT_MESSAGE_NO NUMBER(16) PRIMARY KEY, /* 채팅메시지id */
	CHAT_MESSAGE_CONTENT VARCHAR2(4000), /* 채팅메시지내용 */
	CHAT_MESSAGE_REG_DT DATE, /* 채팅메시지보낸시간 */
	MEM_NO NUMBER(16), /* 멤버id */
	CHAT_ROOM_NO NUMBER(16), /* 채팅방id */
	CONSTRAINTS MEM_NO FOREIGN KEY(MEM_NO) 
	REFERENCES CHAT_MEMBER(MEM_NO),
	CONSTRAINTS CHAT_ROOM_NO FOREIGN KEY(CHAT_ROOM_NO) 
	REFERENCES CHAT_ROOM(CHAT_ROOM_NO)
);

/* 채팅방 */
CREATE TABLE CHAT_ROOM (
	CHAT_ROOM_NO NUMBER(16) PRIMARY KEY, /* 채팅방id */
	CHAT_ROOM_NM VARCHAR(255), /* 채팅방이름 */
	CHAT_ROOM_REG_DT DATE, /* 채팅방 생성시간 */
	CHAT_MEMBERS VARCHAR2(4000) /* 참여자id */
);

DROP SEQUENCE CHAT_MESSAGE_SEQ;

--채팅멤버
CREATE SEQUENCE CHAT_MEMBER_SEQ START WITH 1 INCREMENT BY 1;
--채팅메시지
CREATE SEQUENCE CHAT_MESSAGE_SEQ START WITH 1 INCREMENT BY 1;
--채팅방
CREATE SEQUENCE CHAT_ROOM_SEQ START WITH 1 INCREMENT BY 1;


--INSERT 
-- 채팅 멤버
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(1, 'Y', TO_DATE('2021-11-01 01:01:01','YYYY-MM-DD HH24:MI:SS'), 1);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(2, 'Y', TO_DATE('2021-11-02 02:02:02','YYYY-MM-DD HH24:MI:SS'), 2);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(3, 'Y', TO_DATE('2021-11-03 04:04:04','YYYY-MM-DD HH24:MI:SS'), 3);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(4, 'Y', TO_DATE('2021-11-02 02:02:02','YYYY-MM-DD HH24:MI:SS'), 4);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(5, 'Y', TO_DATE('2021-11-03 04:04:04','YYYY-MM-DD HH24:MI:SS'), 5);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(6, 'Y', TO_DATE('2021-11-02 03:03:03','YYYY-MM-DD HH24:MI:SS'), 6);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(7, 'Y', TO_DATE('2021-11-03 05:05:05','YYYY-MM-DD HH24:MI:SS'), 7);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(8, 'Y', TO_DATE('2021-11-03 03:03:03','YYYY-MM-DD HH24:MI:SS'), 8);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(9, 'Y', TO_DATE('2021-11-04 05:05:05','YYYY-MM-DD HH24:MI:SS'), 9);


INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(10, 'N', TO_DATE('2021-11-01 01:01:01','YYYY-MM-DD HH24:MI:SS'), 10);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(11, 'Y', TO_DATE('2021-11-02 03:03:03','YYYY-MM-DD HH24:MI:SS'), 10);
INSERT INTO CHAT_MEMBER
(MEM_NO, CHAT_MEMBER_ST, CHAT_MEMBER_JOIN_DT, EMP_NO)
VALUES(12, 'Y', TO_DATE('2021-11-03 05:05:05','YYYY-MM-DD HH24:MI:SS'), 10);


-- 채팅방
INSERT INTO CHAT_ROOM
(CHAT_ROOM_NO, CHAT_ROOM_NM, CHAT_ROOM_REG_DT, CHAT_MEMBERS)
VALUES(1, '룸1', TO_DATE('2021-11-01 01:01:01','YYYY-MM-DD HH24:MI:SS'), '1,10');

문자열을 데이트타입으로 입력
INSERT INTO 테이블 (날짜컬럼)
	VALUES ( TO_DATE('10-04-2010 20:37:50','MM-DD-YYYY HH24:MI:SS') )

데이트타입을 문자열로 출력
SELECT TO_CHAR(날짜컬럼,'YYYY-MM-DD HH24:MI:SS') FROM 테이블

INSERT INTO CHAT_ROOM
(CHAT_ROOM_NO, CHAT_ROOM_NM, CHAT_ROOM_REG_DT, CHAT_MEMBERS)
VALUES(2, '룸2', TO_DATE('2021-11-02 02:02:02','YYYY-MM-DD HH24:MI:SS'), '2,4');
INSERT INTO CHAT_ROOM
(CHAT_ROOM_NO, CHAT_ROOM_NM, CHAT_ROOM_REG_DT, CHAT_MEMBERS)
VALUES(3, '룸3', TO_DATE('2021-11-02 03:03:03','YYYY-MM-DD HH24:MI:SS'), '6,8,11');
INSERT INTO CHAT_ROOM
(CHAT_ROOM_NO, CHAT_ROOM_NM, CHAT_ROOM_REG_DT, CHAT_MEMBERS)
VALUES(4, '룸4', TO_DATE('2021-11-03 04:04:04','YYYY-MM-DD HH24:MI:SS'), '3,5');
INSERT INTO CHAT_ROOM
(CHAT_ROOM_NO, CHAT_ROOM_NM, CHAT_ROOM_REG_DT, CHAT_MEMBERS)
VALUES(5, '룸5', TO_DATE('2021-11-03 05:05:05','YYYY-MM-DD HH24:MI:SS'), '7,9,12');

-- 채팅메시지
--채팅방1
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용1', TO_DATE('2021-11-01 01:01:01','YYYY-MM-DD HH24:MI:SS'), 1, 1);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용2', TO_DATE('2021-11-01 01:02:01','YYYY-MM-DD HH24:MI:SS'), 10, 1);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용3', TO_DATE('2021-11-01 01:03:01','YYYY-MM-DD HH24:MI:SS'), 10, 1);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용4', TO_DATE('2021-11-01 01:04:01','YYYY-MM-DD HH24:MI:SS'), 1, 1);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용5', TO_DATE('2021-11-01 01:05:01','YYYY-MM-DD HH24:MI:SS'), 10, 1);

--채팅방2
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용1', TO_DATE('2021-11-02 02:04:02','YYYY-MM-DD HH24:MI:SS'), 4, 2);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용2', TO_DATE('2021-11-02 02:04:58','YYYY-MM-DD HH24:MI:SS'), 2, 2);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용3', TO_DATE('2021-11-02 02:05:02','YYYY-MM-DD HH24:MI:SS'), 4, 2);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용4', TO_DATE('2021-11-02 02:05:32','YYYY-MM-DD HH24:MI:SS'), 2, 2);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용5', TO_DATE('2021-11-02 02:06:02','YYYY-MM-DD HH24:MI:SS'), 4, 2);

--채팅방3
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용1', TO_DATE('2021-11-02 03:03:03','YYYY-MM-DD HH24:MI:SS'), 6, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용2', TO_DATE('2021-11-02 03:10:03','YYYY-MM-DD HH24:MI:SS'), 11, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용3', TO_DATE('2021-11-02 03:11:03','YYYY-MM-DD HH24:MI:SS'), 6, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용4', TO_DATE('2021-11-02 03:11:13','YYYY-MM-DD HH24:MI:SS'), 6, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용5', TO_DATE('2021-11-02 03:11:15','YYYY-MM-DD HH24:MI:SS'), 11, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용6', TO_DATE('2021-11-02 03:03:03','YYYY-MM-DD HH24:MI:SS'), 11, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용7', TO_DATE('2021-11-03 06:10:03','YYYY-MM-DD HH24:MI:SS'), 8, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용8', TO_DATE('2021-11-03 06:11:03','YYYY-MM-DD HH24:MI:SS'), 6, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용9', TO_DATE('2021-11-04 03:11:13','YYYY-MM-DD HH24:MI:SS'), 8, 3);
INSERT INTO CHAT_MESSAGE
(CHAT_MESSAGE_NO, CHAT_MESSAGE_CONTENT, CHAT_MESSAGE_REG_DT, MEM_NO, CHAT_ROOM_NO)
VALUES(CHAT_MESSAGE_SEQ.NEXTVAL, '내용10', TO_DATE('2021-11-05 03:11:15','YYYY-MM-DD HH24:MI:SS'), 11, 3);


--SELECT 문 테스트
--채팅창
-- 보낸 사람 이름 가져오기
SELECT MEM.MEM_NO , MEM.CHAT_MEMBER_ST , MEM.CHAT_MEMBER_JOIN_DT , MEM.EMP_NO , E.EMP_NO , E.EMP_NM 
	FROM CHAT_MEMBER MEM LEFT JOIN EMP E 
	ON MEM.EMP_NO = E.EMP_NO 
	WHERE E.EMP_NO = 10 ;

-- 보낸사람에 맞는 메시지 전송 시간, 내용 가져오기, 채팅방 참여자
SELECT MESSAGE.*, MEM.*, ROOM.*
	FROM CHAT_MESSAGE MESSAGE LEFT JOIN CHAT_MEMBER MEM 
	ON MESSAGE.MEM_NO = MEM.MEM_NO
	LEFT JOIN CHAT_ROOM ROOM 
	ON MESSAGE.CHAT_ROOM_NO = ROOM.CHAT_ROOM_NO 
	WHERE ROOM.CHAT_ROOM_NO = 1 ;
--	AND MEM.MEM_NO = 1;

--채팅방목록
-- 채팅방 이름, 가장 최근의 메시지 내용
SELECT * FROM CHAT_MESSAGE 
	WHERE CHAT_MESSAGE_NO = 
	(SELECT MAX(CHAT_MESSAGE_NO) FROM CHAT_MESSAGE WHERE CHAT_ROOM_NO  = 1);

-- 채팅 사원목록
--이건 디비에서 셀렉트 해오는 게 아니라 세션에서 로그인한 사람들의 정보를 받아서 출력해줘야함

--사원목록에서 채팅할 사람을 고르면 채팅방 테이블에 채팅방이 추가되는 동시에 채팅하는 사람이 채팅멤버 테이블에 추가되어야함
--(트랜잭션...? 처리..?)

--사용자가 새로고침을 하지 않더라도 실시간으로 변경되어야하는데 우짤겨,,?


--업무일지
DROP SEQUENCE WORKLOG_SEQ;
DROP TABLE WORKLOG;

CREATE SEQUENCE WORKLOG_SEQ START WITH 1 INCREMENT BY 1;

-- INSERT 
INSERT INTO WORKLOG
(WORKLOG_NO, WORKLOG_REG_DT, WORKLOG_MODIFY_DT, WORKLOG_CONTENT, EMP_NO)
VALUES(1, TO_DATE('2021-11-01 03:11:13','YYYY-MM-DD HH24:MI:SS'), '', '업무일지내용1', 1);
INSERT INTO WORKLOG
(WORKLOG_NO, WORKLOG_REG_DT, WORKLOG_MODIFY_DT, WORKLOG_CONTENT, EMP_NO)
VALUES(2, TO_DATE('2021-11-08 03:11:13','YYYY-MM-DD HH24:MI:SS'), '', '업무일지내용2', 1);
INSERT INTO WORKLOG
(WORKLOG_NO, WORKLOG_REG_DT, WORKLOG_MODIFY_DT, WORKLOG_CONTENT, EMP_NO)
VALUES(3, TO_DATE('2021-11-03 03:11:13','YYYY-MM-DD HH24:MI:SS'), TO_DATE('2021-11-05 03:11:13','YYYY-MM-DD HH24:MI:SS'), '업무일지내용3', 2);
INSERT INTO WORKLOG
(WORKLOG_NO, WORKLOG_REG_DT, WORKLOG_MODIFY_DT, WORKLOG_CONTENT, EMP_NO)
VALUES(4, TO_DATE('2021-11-04 03:11:13','YYYY-MM-DD HH24:MI:SS'), '', '업무일지내용4', 3);
INSERT INTO WORKLOG
(WORKLOG_NO, WORKLOG_REG_DT, WORKLOG_MODIFY_DT, WORKLOG_CONTENT, EMP_NO)
VALUES(5, TO_DATE('2021-11-05 03:11:13','YYYY-MM-DD HH24:MI:SS'), '', '업무일지내용5', 3);

